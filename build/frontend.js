(()=>{"use strict";const e=e=>"boolean"==typeof e?e:"string"==typeof e?"1"===e||"true"===e.toLowerCase():"number"==typeof e?1===e:!!e,t=e=>{if(!e?.bodyAttributes)return;const t=document.body;t&&Object.entries({themeMode:"theme",buttonSize:"button-size",buttonPosition:"position",borderRadius:"border-radius",shadowStyle:"shadow"}).forEach(([n,a])=>{const o=e.bodyAttributes[n],i=`data-chatkit-${a}`;null!=o&&""!==o?t.setAttribute(i,String(o)):t.removeAttribute(i)})},n=e=>{const t=document.createElement("div");t.style.cssText='position: fixed; bottom: 20px; right: 20px; padding: 15px 20px; background: #f8d7da; color: #721c24; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.15); z-index: 9999; max-width: 300px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;',t.setAttribute("role","alert"),t.innerHTML=`<p style="margin: 0; font-size: 14px;">${e}</p>`,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>t.remove(),300))},5e3)},a=window.chatkitConfig||{},o=(e=>async()=>{const t=e.i18n||{};try{if(!e.restUrl)throw new Error("Missing configuration");const t={"Content-Type":"application/json"},n=new AbortController,a=setTimeout(()=>n.abort(),1e4),o=await fetch(e.restUrl,{method:"POST",headers:t,signal:n.signal,credentials:"same-origin"});if(clearTimeout(a),!o.ok){const e=await o.json().catch(()=>({}));throw console.error("ChatKit Session Error:",{status:o.status,statusText:o.statusText,error:e}),new Error(e.message||`HTTP ${o.status}`)}const i=await o.json();if(!i.client_secret)throw new Error("Invalid response: missing client_secret");return i.client_secret}catch(e){console.error("Fetch Session Error:",e);const n=t.unableToStart||"‚ö†Ô∏è Unable to start chat. Please try again later.",a=document.getElementById("myChatkit");if(a&&a.parentNode){const e=document.createElement("div");e.style.cssText="padding: 20px; text-align: center; color: #721c24; background: #f8d7da; border-radius: 8px; margin: 20px;",e.setAttribute("role","alert"),e.innerHTML=`<p style="margin: 0; font-size: 14px;">${n}</p>`,a.parentNode.insertBefore(e,a)}return"undefined"!=typeof gtag&&gtag("event","exception",{description:`ChatKit session error: ${e.message}`,fatal:!1}),null}})(a),i=()=>{const e=[],t=a.prompts;return Array.isArray(t)&&t.length>0?t.forEach(t=>{t&&t.label&&t.text&&e.push({icon:t.icon||"circle-question",label:t.label,prompt:t.text})}):[1,2,3,4,5].forEach(t=>{const n=a[`defaultPrompt${t}`],o=a[`default_prompt_${t}`],i=n||o,r=a[`defaultPrompt${t}Text`],s=a[`default_prompt_${t}_text`],l=r||s,c=a[`defaultPrompt${t}Icon`],d=a[`default_prompt_${t}_icon`],m=c||d||"circle-question";i&&l&&e.push({icon:m,label:i,prompt:l})}),e.length||e.push({icon:"circle-question",label:"How can I assist you?",prompt:"Hi! How can I assist you today?"}),e},r=async()=>{if(!a.restUrl){console.error("ChatKit configuration missing: restUrl not defined");const e=a.i18n?.configError||"‚ö†Ô∏è Chat configuration error. Please contact support.";return void n(e)}t(a),await((e={})=>customElements.get("openai-chatkit")?Promise.resolve():new Promise((t,n)=>{const a=document.createElement("script");a.src=e.loaderUrl||"https://cdn.platform.openai.com/deployments/chatkit/chatkit.js",a.defer=!0,a.onload=t,a.onerror=()=>n(new Error("Failed to load ChatKit loader")),document.head.appendChild(a)}))(a),customElements.get("openai-chatkit")||await customElements.whenDefined("openai-chatkit");const r=document.getElementById("myChatkit");if(!r)return console.error("Element #myChatkit not found in DOM"),void n("‚ö†Ô∏è Chat widget failed to load. Please refresh the page.");(()=>{const e=document.getElementById("chatToggleBtn"),t=document.getElementById("myChatkit"),o=document.getElementById("chatkitChannelPicker"),i=document.getElementById("chatkitEmailPanel"),r=document.getElementById("chatkitEmailForm");if(!(e&&t&&o&&i))return void console.warn("ChatKit toggle elements not found");const s=a.accentColor||"#FF4500",l=[t,o,i],c=e.getAttribute("aria-label")||"Toggle chat window",d=a.closeText||c;let m,h=!1;const u=e=>{document.body.style.overflow=e?"hidden":""},p=e=>{const n="picker"===e;o.hidden=!n,o.style.display=n?"flex":"none",n&&setTimeout(()=>{const e=o.querySelector(".chatkit-channel-card");e?.focus()},80);const a="email"===e;i.hidden=!a,i.style.display=a?"block":"none",a&&setTimeout(()=>{const e=i.querySelector('input[name="email"]');e?.focus()},120);const r="chat"===e;t.hidden=!r,t.style.display=r?"block":"none",t.setAttribute("aria-modal",r?"true":"false"),r&&setTimeout(()=>t.focus(),140)},g=(t="picker")=>{h=!0,e.classList.add("chatkit-open"),e.style.backgroundColor=s,e.setAttribute("aria-expanded","true"),e.setAttribute("aria-label",d),p(t),m?.cancel(),m?.hide(),window.innerWidth<=768&&u(!0)},f=()=>{h=!1,e.classList.remove("chatkit-open"),e.style.backgroundColor=s,e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label",c),p(null),e.focus(),m?.scheduleRepeat(),u(!1)};m=((e={},t,n)=>{const a=document.getElementById("chatkitNudge"),o=a?a.querySelector(".chatkit-nudge__dismiss"):null,i=Boolean(e.enabled&&a),r=1e3*Math.max(3,parseInt(e.initialDelay||12,10)),s=1e3*Math.max(10,parseInt(e.repeatDelay||36,10));let l=null,c=!1;const d=()=>{a&&(a.hidden=!0)},m=()=>{l&&(clearTimeout(l),l=null)},h=e=>{i&&!c&&(m(),l=setTimeout(()=>{i&&!c&&a&&(a.hidden=!1),h(s)},e))};return i&&t&&t.addEventListener("mouseenter",d),i&&a&&a.addEventListener("click",e=>{e.target!==o&&"function"==typeof n&&n()}),i&&o&&o.addEventListener("click",e=>{e.stopPropagation(),c=!0,d(),m()}),{enabled:i,scheduleInitial:()=>h(r),scheduleRepeat:()=>h(s),hide:d,cancel:m,markDismissed:()=>{c=!0,d(),m()}}})(a.nudge,e,()=>g("picker")),e.addEventListener("click",()=>{h?f():g("picker")}),o.querySelectorAll("[data-channel]").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-channel");"email"===t?p("email"):"chat"===t&&p("chat")})}),document.querySelectorAll(".chatkit-back-button").forEach(e=>{e.addEventListener("click",()=>{p("picker")})}),r&&r.addEventListener("submit",e=>{e.preventDefault();const t=r.querySelector('input[name="email"]'),a=r.querySelector('textarea[name="message"]'),o=(i.dataset.contactEmail||"").trim();if(!o)return void n("Email destination not configured. Please contact the site administrator.");const s=t?t.value.trim():"",l=a?a.value.trim():"",c=encodeURIComponent(`Website enquiry from ${s||"visitor"}`),d=[];s&&(d.push(`From: ${s}`),d.push("")),l&&d.push(l);const m=encodeURIComponent(d.join("\n"));window.location.href=`mailto:${o}?subject=${c}&body=${m}`,f()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&h&&f()}),document.addEventListener("click",t=>{if(!h)return;const n=l.some(e=>e&&e.contains(t.target)),a=e.contains(t.target);n||a||f()}),e.addEventListener("mouseenter",()=>m.hide()),m.scheduleInitial()})(),await(async t=>{const n={api:{getClientSecret:o},theme:{colorScheme:a.themeMode||"dark",radius:"round",density:"normal",color:{accent:{primary:a.accentColor||"#FF4500",level:parseInt(a.accentLevel||2,10)}},typography:{baseSize:16,fontFamily:'"OpenAI Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'}},composer:{attachments:{enabled:e(a.enableAttachments)},placeholder:a.placeholderText||"Send a message..."},startScreen:{greeting:a.greetingText||"How can I help you today?",prompts:i()}};if(e(a.enableAttachments)){const e=parseInt(a.attachmentMaxSize||20,10),t=parseInt(a.attachmentMaxCount||3,10);n.composer.attachments={enabled:!0,maxSize:1024*e*1024,maxCount:t,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg",".gif",".webp"],"text/plain":[".txt"]}}}if(a.initialThreadId&&""!==a.initialThreadId.trim()&&(n.initialThread=a.initialThreadId),a.disclaimerText&&""!==a.disclaimerText.trim()&&(n.disclaimer={text:a.disclaimerText,highContrast:e(a.disclaimerHighContrast)}),a.customFont&&a.customFont.fontFamily&&""!==a.customFont.fontFamily.trim()&&(n.theme.typography={fontFamily:a.customFont.fontFamily,baseSize:parseInt(a.customFont.baseSize||16,10)}),e(a.showHeader)){const e={enabled:!0};if(a.headerTitleText&&""!==a.headerTitleText.trim()&&(e.title={enabled:!0,text:a.headerTitleText}),a.headerLeftIcon&&a.headerLeftUrl&&""!==a.headerLeftUrl.trim())try{new URL(a.headerLeftUrl),e.leftAction={icon:a.headerLeftIcon,onClick:()=>{window.location.href=a.headerLeftUrl}}}catch(e){console.warn("‚ö†Ô∏è Invalid left button URL, skipping")}if(a.headerRightIcon&&a.headerRightUrl&&""!==a.headerRightUrl.trim())try{new URL(a.headerRightUrl),e.rightAction={icon:a.headerRightIcon,onClick:()=>{window.location.href=a.headerRightUrl}}}catch(e){console.warn("‚ö†Ô∏è Invalid right button URL, skipping")}n.header=e}else n.header={enabled:!1};n.history={enabled:e(a.historyEnabled)},a.locale&&""!==a.locale.trim()&&(n.locale=a.locale),console.log("üöÄ Initializing ChatKit with final config:",n),t.style.display="block",t.setOptions(n),"undefined"!=typeof gtag&&gtag("event","chatkit_initialized",{event_category:"engagement",event_label:"ChatKit Ready"})})(r)};document.addEventListener("DOMContentLoaded",()=>{r().catch(e=>{console.error("‚ùå ChatKit Initialization Error:",e),n(a.i18n?.loadFailed||"‚ö†Ô∏è Chat initialization failed. Please refresh the page.")})}),document.addEventListener("visibilitychange",()=>{document.hidden||t(a)}),window.addEventListener("beforeunload",()=>{document.body.style.overflow=""})})();
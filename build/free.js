(()=>{"use strict";const e=e=>{if(!e?.bodyAttributes)return;const t=document.body;t&&Object.entries({themeMode:"theme",buttonSize:"button-size",buttonPosition:"position",borderRadius:"border-radius",shadowStyle:"shadow"}).forEach(([o,n])=>{const r=e.bodyAttributes[o],a=`data-chatkit-${n}`;null!=r&&""!==r?t.setAttribute(a,String(r)):t.removeAttribute(a)})},t=e=>{const t=document.createElement("div");t.style.cssText='position: fixed; bottom: 20px; right: 20px; padding: 15px 20px; background: #f8d7da; color: #721c24; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.15); z-index: 9999; max-width: 300px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;',t.setAttribute("role","alert"),t.innerHTML=`<p style="margin: 0; font-size: 14px;">${e}</p>`,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>t.remove(),300))},5e3)},o=window.chatkitConfig||{},n=(e=>async()=>{const t=e.i18n||{};try{if(!e.restUrl)throw new Error("Missing configuration");const t={"Content-Type":"application/json"},o=new AbortController,n=setTimeout(()=>o.abort(),1e4),r=await fetch(e.restUrl,{method:"POST",headers:t,signal:o.signal,credentials:"same-origin"});if(clearTimeout(n),!r.ok){const e=await r.json().catch(()=>({}));throw console.error("ChatKit Session Error:",{status:r.status,statusText:r.statusText,error:e}),new Error(e.message||`HTTP ${r.status}`)}const a=await r.json();if(!a.client_secret)throw new Error("Invalid response: missing client_secret");return a.client_secret}catch(e){console.error("Fetch Session Error:",e);const o=t.unableToStart||"‚ö†Ô∏è Unable to start chat. Please try again later.",n=document.getElementById("myChatkit");if(n&&n.parentNode){const e=document.createElement("div");e.style.cssText="padding: 20px; text-align: center; color: #721c24; background: #f8d7da; border-radius: 8px; margin: 20px;",e.setAttribute("role","alert"),e.innerHTML=`<p style="margin: 0; font-size: 14px;">${o}</p>`,n.parentNode.insertBefore(e,n)}return"undefined"!=typeof gtag&&gtag("event","exception",{description:`ChatKit session error: ${e.message}`,fatal:!1}),null}})(o),r=async()=>{if(!o.restUrl){console.error("ChatKit configuration missing: restUrl not defined");const e=o.i18n?.configError||"‚ö†Ô∏è Chat configuration error. Please contact support.";return void t(e)}e(o);try{await((e={})=>customElements.get("openai-chatkit")?Promise.resolve():new Promise((t,o)=>{const n=document.createElement("script");n.src=e.loaderUrl||"https://cdn.platform.openai.com/deployments/chatkit/chatkit.js",n.defer=!0,n.onload=t,n.onerror=()=>o(new Error("Failed to load ChatKit loader")),document.head.appendChild(n)}))(o)}catch(e){return console.error("Failed to load ChatKit loader",e),void t(o.i18n?.loadFailed||"‚ö†Ô∏è Chat widget failed to load. Please refresh the page.")}customElements.get("openai-chatkit")||await customElements.whenDefined("openai-chatkit");const r=document.getElementById("myChatkit");if(!r)return console.error("Element #myChatkit not found in DOM"),void t("‚ö†Ô∏è Chat widget failed to load. Please refresh the page.");(()=>{const e=document.getElementById("chatToggleBtn"),t=document.getElementById("myChatkit");if(!e||!t)return void console.warn("ChatKit toggle elements not found");let o=!1;const n=()=>{o=!1,e.classList.remove("chatkit-open"),e.setAttribute("aria-expanded","false"),t.hidden=!0,t.style.display="none",document.body.style.overflow=""};e.addEventListener("click",()=>{o?n():(o=!0,e.classList.add("chatkit-open"),e.setAttribute("aria-expanded","true"),t.hidden=!1,t.style.display="block",window.innerWidth<=768&&(document.body.style.overflow="hidden"),setTimeout(()=>t.focus(),140))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&o&&n()})})(),await(async e=>{const t={api:{getClientSecret:n},theme:{colorScheme:o.themeMode||"dark",radius:"round",density:"normal",color:{accent:{primary:o.accentColor||"#FF4500",level:parseInt(o.accentLevel||2,10)}},typography:{baseSize:16,fontFamily:'"OpenAI Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'}},composer:{attachments:{enabled:!1},placeholder:o.placeholderText||"Send a message..."},startScreen:{greeting:o.greetingText||"How can I help you today?",prompts:[]},history:{enabled:!0}};console.log("üöÄ Initializing ChatKit (free) with config:",t),e.style.display="block",e.setOptions(t)})(r)};document.addEventListener("DOMContentLoaded",()=>{r().catch(e=>{console.error("‚ùå ChatKit Initialization Error:",e),t(o.i18n?.loadFailed||"‚ö†Ô∏è Chat initialization failed. Please refresh the page.")})}),document.addEventListener("visibilitychange",()=>{document.hidden||e(o)}),window.addEventListener("beforeunload",()=>{document.body.style.overflow=""})})();